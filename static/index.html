<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academy AI - CWS Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Cor Personalizada (Roxo Profundo) */
        .bg-brand {
            background-color: #6b21a8;
        }

        /* Roxo 800 */
        .text-brand {
            color: #6b21a8;
        }

        .hover-bg-brand:hover {
            background-color: #581c87;
        }

        .ring-brand:focus {
            --tw-ring-color: #6b21a8;
        }

        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* Markdown Styles */
        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3 {
            font-weight: 700;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #1f2937;
        }

        .markdown-content p {
            margin-bottom: 0.75rem;
        }

        .markdown-content strong {
            font-weight: 700;
            color: #111827;
        }

        .markdown-content ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .markdown-content ol {
            list-style-type: decimal;
            padding-left: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            font-size: 0.9em;
        }

        .markdown-content th {
            background-color: #f3f4f6;
            font-weight: 600;
            text-align: left;
            padding: 8px;
            border: 1px solid #e5e7eb;
        }

        .markdown-content td {
            padding: 8px;
            border: 1px solid #e5e7eb;
        }

        .markdown-content a {
            color: #6b21a8;
            text-decoration: underline;
        }

        .markdown-content code {
            background-color: #f3f4f6;
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-family: monospace;
            color: #9333ea;
        }

        .markdown-content pre {
            background-color: #1f2937;
            color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body class="bg-gray-50 h-screen w-screen overflow-hidden flex flex-col">

    <div class="bg-white w-full h-full flex flex-col shadow-none">

        <div
            class="bg-white border-b border-gray-200 p-4 flex justify-between items-center shadow-sm z-10 shrink-0 h-16">
            <div class="flex items-center gap-3">
                <img src="/static/logo-preto-platform.png" alt="Logo Platform" class="h-8 w-auto object-contain">

                <div class="hidden sm:block h-6 w-px bg-gray-300 mx-2"></div>
                <p class="hidden sm:block text-gray-500 text-xs font-medium uppercase tracking-wider">Assistant AI</p>
            </div>

            <a href="/admin"
                class="text-gray-500 hover:text-brand text-sm font-medium transition-colors border border-gray-200 px-3 py-1.5 rounded-lg hover:bg-purple-50 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Admin
            </a>
        </div>

        <div id="chat-box" class="flex-1 overflow-y-auto p-4 sm:p-8 space-y-8 bg-gray-50 scroll-smooth">

            <div class="flex items-start gap-4 max-w-5xl mx-auto pt-4">
                <div
                    class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0 border border-purple-200">
                    ü§ñ
                </div>
                <div
                    class="bg-white p-5 rounded-2xl rounded-tl-none shadow-sm border border-gray-200 text-gray-700 max-w-[90%] md:max-w-[75%] leading-relaxed">
                    Ol√°! Sou o assistente virtual da plataforma. Como posso te ajudar hoje?
                </div>
            </div>

        </div>

        <div id="typing-indicator" class="hidden px-8 pb-4 max-w-5xl mx-auto w-full">
            <div
                class="flex items-center gap-2 bg-white p-3 rounded-2xl rounded-tl-none w-fit border border-gray-200 shadow-sm ml-12">
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
            </div>
        </div>

        <div class="p-4 bg-white border-t border-gray-200 shrink-0">
            <form id="chat-form" class="relative flex items-center gap-2 max-w-5xl mx-auto w-full">
                <input type="text" id="user-input"
                    class="w-full bg-gray-100 text-gray-800 rounded-xl pl-5 pr-14 py-4 focus:outline-none focus:ring-2 ring-brand transition-all placeholder-gray-500 shadow-inner text-base"
                    placeholder="Digite sua d√∫vida sobre a plataforma..." autocomplete="off">
                <button type="submit"
                    class="absolute right-2 p-2.5 bg-brand hover-bg-brand text-white rounded-lg transition-colors shadow-sm group">
                    <svg class="w-5 h-5 group-hover:translate-x-0.5 transition-transform" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                    </svg>
                </button>
            </form>
            <p class="text-center text-[10px] text-gray-400 mt-3 font-medium tracking-wide">CONFIDENCIAL CWS ‚Ä¢ IA
                BASEADA EM DOCUMENTA√á√ÉO OFICIAL</p>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chat-box');
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const typingIndicator = document.getElementById('typing-indicator');

        const renderer = new marked.Renderer();
        const linkRenderer = renderer.link;
        renderer.link = (href, title, text) => {
            const html = linkRenderer.call(renderer, href, title, text);
            return html.replace(/^<a /, '<a target="_blank" rel="noopener noreferrer" ');
        };
        marked.setOptions({ renderer: renderer });

        function scrollToBottom() {
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function appendMessage(sender, text) {
            const div = document.createElement('div');
            div.className = "max-w-5xl mx-auto w-full flex " + (sender === 'user' ? "justify-end" : "justify-start");

            if (sender === 'user') {
                div.innerHTML = `
                    <div class="flex items-start gap-4 justify-end w-full">
                        <div class="bg-brand p-4 rounded-2xl rounded-tr-none shadow-md text-white max-w-[90%] md:max-w-[75%] text-left leading-relaxed">
                            ${text}
                        </div>
                        <div class="w-8 h-8 rounded-full bg-purple-200 flex items-center justify-center flex-shrink-0 text-purple-900 font-bold text-xs border border-purple-300">
                            VC
                        </div>
                    </div>
                `;
            } else {
                const htmlContent = marked.parse(text);
                div.innerHTML = `
                    <div class="flex items-start gap-4 w-full">
                        <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0 text-xl border border-purple-200">
                            ü§ñ
                        </div>
                        <div class="bg-white p-5 rounded-2xl rounded-tl-none shadow-sm border border-gray-200 text-gray-700 max-w-[90%] md:max-w-[75%] markdown-content">
                            ${htmlContent}
                        </div>
                    </div>
                `;
            }

            chatBox.appendChild(div);
            scrollToBottom();
        }

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = userInput.value.trim();
            if (!message) return;

            appendMessage('user', message);
            userInput.value = '';
            userInput.disabled = true;

            typingIndicator.classList.remove('hidden');
            scrollToBottom();

            try {
                const res = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const data = await res.json();
                appendMessage('ai', data.response);
            } catch (error) {
                appendMessage('ai', "‚ö†Ô∏è Ops! Tive um problema de conex√£o. Tente novamente.");
            } finally {
                typingIndicator.classList.add('hidden');
                userInput.disabled = false;
                userInput.focus();
                scrollToBottom();
            }
        });
    </script>
</body>

</html>